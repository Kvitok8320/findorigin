# Детальная диагностика ошибки 403

## Если все настроено правильно, но ошибка сохраняется:

### 1. Проверьте точное значение API ключа

1. В Google Cloud Console: **"APIs & Services"** → **"Credentials"**
2. Найдите "API key 1"
3. Нажмите "Show key" (или иконку глаза)
4. Скопируйте ключ полностью (должен начинаться с `AIzaSy...`)
5. Проверьте на Vercel, что значение точно такое же (без пробелов, без кавычек)

### 2. Проверьте точное значение Search Engine ID

1. Перейдите на https://cse.google.com/cse/all
2. Найдите вашу поисковую систему
3. Нажмите на неё
4. **"Setup"** → **"Basics"**
5. Скопируйте **"Search engine ID"** полностью
6. Проверьте на Vercel, что значение точно такое же

### 3. Проверьте формат переменных на Vercel

На Vercel переменные должны быть:
```
GOOGLE_API_KEY=AIzaSy... (без пробелов, без кавычек)
GOOGLE_SEARCH_ENGINE_ID=52fb00e8fe74e4451 (без пробелов)
```

**НЕ должно быть:**
- `GOOGLE_API_KEY = AIzaSy...` (с пробелами)
- `GOOGLE_API_KEY="AIzaSy..."` (с кавычками)
- `GOOGLE_API_KEY= AIzaSy...` (с пробелом после =)

### 4. Проверьте, что проект на Vercel использует правильные переменные

1. На Vercel: **Deployments** → последний деплой
2. **Functions** → `/api/telegram`
3. Проверьте логи - должны быть записи о том, что переменные загружены

### 5. Попробуйте создать новый API ключ

Иногда старые ключи могут иметь проблемы:

1. Создайте новый API ключ в Google Cloud Console
2. Ограничьте его Custom Search API
3. Обновите `GOOGLE_API_KEY` на Vercel
4. Передеплойте проект

### 6. Проверьте квоты API

1. В Google Cloud Console: **"APIs & Services"** → **"Quotas"**
2. Найдите "Custom Search API"
3. Проверьте, не превышены ли лимиты

### 7. Проверьте, что API включен в правильном проекте

1. Убедитесь, что проект "educationcursor" выбран
2. Проверьте, что API включен именно в этом проекте
3. Проверьте, что API ключ создан в том же проекте

### 8. Тест через curl

Попробуйте сделать запрос напрямую:

```bash
curl "https://www.googleapis.com/customsearch/v1?key=ВАШ_API_КЛЮЧ&cx=52fb00e8fe74e4451&q=test"
```

Если это работает - проблема в Vercel или коде.
Если не работает - проблема в API ключе или Search Engine ID.

### 9. Проверьте логи на Vercel более детально

1. На Vercel: **Deployments** → последний деплой
2. **Functions** → `/api/telegram`
3. Найдите логи с ошибкой 403
4. Проверьте, какие именно значения переменных используются

### 10. Временное решение - используйте другой API

Если проблема не решается, можно временно использовать:
- **Bing Search API** (1000 запросов/месяц бесплатно)
- **SerpAPI** (100 запросов бесплатно)

## Что проверить в первую очередь:

1. ✅ API включен - проверено
2. ✅ API ключ ограничен - проверено
3. ⬜ **Точные значения переменных на Vercel** - проверьте
4. ⬜ **Формат переменных (без пробелов)** - проверьте
5. ⬜ **Передеплой после изменений** - проверьте
6. ⬜ **Тест через curl** - попробуйте

