# Настройка Yandex Cloud Search API

## Проблема

Старый XML API Яндекс.Поиска (`https://yandex.ru/search/xml`) больше не работает. Ошибка:
```
XML-search queries with the old authorization type (&user=...) are forbidden. 
Please use Yandex Cloud gateway to send requests.
```

## Решение: Yandex Cloud Search API

Нужно использовать новый API через Yandex Cloud.

## Пошаговая инструкция:

### Шаг 1: Регистрация в Yandex Cloud

1. Перейдите на **https://console.cloud.yandex.ru**
2. Войдите в свой Яндекс аккаунт
3. Создайте облако (если еще не создано)
4. Создайте папку (folder) для проекта

### Шаг 2: Активация Search API

1. В консоли Yandex Cloud перейдите в раздел **"API и сервисы"**
2. Найдите **"Search API"** или **"Поиск"**
3. Нажмите **"Подключить"** или **"Активировать"**

### Шаг 3: Создание сервисного аккаунта

1. Перейдите в **"Сервисные аккаунты"**
2. Нажмите **"Создать сервисный аккаунт"**
3. Заполните:
   - **Имя**: например, "findorigin-bot"
   - **Описание**: "Сервисный аккаунт для Telegram бота FindOrigin"
4. Нажмите **"Создать"**

### Шаг 4: Получение IAM токена или API ключа

#### Вариант A: IAM токен (рекомендуется)

1. Выберите созданный сервисный аккаунт
2. Перейдите в **"Ключи"**
3. Нажмите **"Создать новый ключ"** → **"IAM токен"**
4. Скопируйте токен (показывается только один раз!)

#### Вариант B: API ключ

1. Выберите созданный сервисный аккаунт
2. Перейдите в **"Ключи"**
3. Нажмите **"Создать новый ключ"** → **"API ключ"**
4. Скопируйте ключ

### Шаг 5: Назначение ролей

1. Выберите сервисный аккаунт
2. Перейдите в **"Права доступа"**
3. Нажмите **"Назначить роли"**
4. Добавьте роль: **"search-api.user"** или **"viewer"**
5. Сохраните

### Шаг 6: Получение Folder ID

1. В консоли Yandex Cloud выберите вашу папку
2. Скопируйте **Folder ID** из URL или из информации о папке
3. Сохраните его (понадобится для настройки)

### Шаг 7: Настройка в Vercel

1. Зайдите на https://vercel.com
2. Откройте ваш проект
3. Перейдите в **Settings** → **Environment Variables**
4. Добавьте переменные:
   - **Key**: `YANDEX_API_KEY`
   - **Value**: ваш IAM токен или API ключ из шага 4
   - **Key**: `YANDEX_FOLDER_ID` (опционально)
   - **Value**: ваш Folder ID из шага 6
5. Нажмите **"Save"**
6. **Передеплойте проект** (Redeploy)

## Альтернативный подход (если Yandex Cloud недоступен)

Если настройка Yandex Cloud вызывает сложности, можно использовать:

1. **Публичный API Яндекс.Поиска** через веб-скрапинг (не рекомендуется для продакшена)
2. **Yandex Webmaster API** (если есть доступ)
3. **Прямые запросы к yandex.ru/search** с парсингом результатов

## Документация

- Yandex Cloud: https://cloud.yandex.ru/docs
- Search API: https://yandex.cloud/en/services/search-api
- IAM токены: https://cloud.yandex.ru/docs/iam/concepts/authorization/iam-token

## Важно

- IAM токены действительны 12 часов, после чего нужно обновлять
- API ключи не имеют срока действия
- Для продакшена рекомендуется использовать API ключи или автоматическое обновление IAM токенов

