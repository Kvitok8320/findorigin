# Устранение ошибки 403 при включенном API

## Ситуация:
- ✅ Custom Search API включен (Status: Enabled)
- ✅ API ключ создан и ограничен Custom Search API
- ❌ Все еще получаете ошибку 403

## Возможные причины и решения:

### 1. Проверьте ограничения API ключа

1. Зайдите в **"APIs & Services"** → **"Credentials"**
2. Найдите ваш API ключ "API key 1"
3. Нажмите на него (или на "Show key")
4. Проверьте раздел **"API restrictions"**:
   - Должно быть выбрано **"Restrict key"**
   - В списке должен быть выбран **"Custom Search API"**
   - Если нет - исправьте и сохраните

### 2. Проверьте переменные окружения на Vercel

1. Зайдите на https://vercel.com
2. Откройте ваш проект
3. Перейдите в **Settings** → **Environment Variables**
4. Проверьте, что есть:
   - `GOOGLE_API_KEY` = ваш API ключ (должен начинаться с `AIzaSy...`)
   - `GOOGLE_SEARCH_ENGINE_ID` = ваш Search Engine ID (например: `52fb00e8fe74e4451`)
5. Убедитесь, что значения правильные (без лишних пробелов)

### 3. Передеплойте проект на Vercel

**ВАЖНО:** После изменения переменных окружения нужно передеплоить проект!

1. На Vercel перейдите в **Deployments**
2. Найдите последний деплой
3. Нажмите на три точки (⋮) рядом с ним
4. Выберите **"Redeploy"**
5. Или сделайте новый коммит и push в Git

### 4. Проверьте правильность API ключа

1. В Google Cloud Console скопируйте API ключ
2. Убедитесь, что он начинается с `AIzaSy...`
3. Проверьте, что в Vercel указан точно такой же ключ (без пробелов)

### 5. Проверьте правильность Search Engine ID

1. Перейдите на https://cse.google.com/cse/all
2. Найдите вашу поисковую систему
3. Нажмите на неё
4. Перейдите в **"Setup"** → **"Basics"**
5. Скопируйте **"Search engine ID"**
6. Убедитесь, что в Vercel указан точно такой же ID

### 6. Подождите несколько минут

После включения API или изменения ограничений может потребоваться 5-10 минут для активации изменений.

### 7. Проверьте квоты API

1. В Google Cloud Console перейдите в **"APIs & Services"** → **"Quotas"**
2. Найдите "Custom Search API"
3. Проверьте, не превышены ли лимиты (100 запросов в день бесплатно)

## Пошаговая проверка:

1. ✅ API включен - проверено
2. ⬜ API ключ правильно ограничен - проверьте
3. ⬜ Переменные окружения на Vercel правильные - проверьте
4. ⬜ Проект передеплоен после изменений - проверьте
5. ⬜ Подождали 5-10 минут - проверьте

## Быстрый тест:

Попробуйте сделать запрос напрямую через curl:

```bash
curl "https://www.googleapis.com/customsearch/v1?key=ВАШ_API_КЛЮЧ&cx=ВАШ_SEARCH_ENGINE_ID&q=test"
```

Если это работает - проблема в Vercel или переменных окружения.
Если не работает - проблема в API ключе или Search Engine ID.

