# Проверка доступа к Google Custom Search API

## Проблема: 403 "This project does not have the access to Custom Search JSON API"

Эта ошибка означает, что **проект Google Cloud не имеет доступа к Custom Search API**.

## Пошаговая проверка:

### Шаг 1: Определите, в каком проекте создан API ключ

1. Откройте: https://console.cloud.google.com/apis/credentials
2. Найдите ваш API ключ (название: `API_KEY_FINDORIGIN` или похожее)
3. Нажмите на название ключа, чтобы открыть его детали
4. **Вверху страницы** будет указано название проекта (например: `findorigin`)
5. Запишите **Project ID** (не название, а ID) - он будет вида `findorigin-123456`

### Шаг 2: Проверьте, что вы в правильном проекте

1. Вверху страницы Google Cloud Console найдите выпадающий список с названием проекта
2. Убедитесь, что выбран проект **"findorigin"** (тот же, где создан ключ)
3. Если нет - выберите правильный проект из списка

### Шаг 3: Проверьте, включен ли Custom Search API в ЭТОМ проекте

**Важно:** API должен быть включен в том же проекте, где создан ключ!

#### Способ 1: Через Enabled APIs (Включенные API)

1. Убедитесь, что выбран проект **"findorigin"**
2. Перейдите: **"APIs & Services"** → **"Enabled APIs"**
3. В поиске введите: **"Custom Search API"**
4. **Если видите "Custom Search API" в списке** - API включен ✅
5. **Если НЕ видите** - API не включен, нужно включить (см. Шаг 4)

#### Способ 2: Через Library (Библиотека)

1. Убедитесь, что выбран проект **"findorigin"**
2. Перейдите: **"APIs & Services"** → **"Library"**
3. В поиске введите: **"Custom Search API"**
4. Нажмите на **"Custom Search API"** в результатах
5. Посмотрите на кнопку:
   - Если написано **"ENABLE"** - API НЕ включен ❌
   - Если написано **"MANAGE"** - API включен ✅

### Шаг 4: Включите Custom Search API (если не включен)

1. На странице Custom Search API нажмите кнопку **"ENABLE"**
2. Подождите 2-3 минуты для активации
3. Проверьте снова через "Enabled APIs"

### Шаг 5: Проверьте ограничения API ключа

1. Перейдите: **"APIs & Services"** → **"Credentials"**
2. Найдите ваш API ключ (`API_KEY_FINDORIGIN`)
3. Нажмите на название ключа
4. Проверьте раздел **"API restrictions"**:
   - Если выбрано **"Don't restrict key"** - это может быть проблемой
   - Если выбрано **"Restrict key"** - проверьте, что в списке есть **"Custom Search API"**
5. Если нужно изменить:
   - Выберите **"Restrict key"**
   - В списке выберите **"Custom Search API"**
   - Нажмите **"Save"**

### Шаг 6: Пересоздайте API ключ (если проблема сохраняется)

Иногда помогает пересоздание ключа:

1. Удалите старый ключ (или создайте новый, не удаляя старый)
2. **Убедитесь, что вы в проекте "findorigin"**
3. Создайте новый ключ: **"APIs & Services"** → **"Credentials"** → **"Create Credentials"** → **"API Key"**
4. Сразу ограничьте его: **"Restrict key"** → выберите **"Custom Search API"** → **"Save"**
5. Скопируйте новый ключ
6. Обновите `GOOGLE_API_KEY` на Vercel:
   - Vercel → Settings → Environment Variables
   - Найдите `GOOGLE_API_KEY`
   - Измените значение на новый ключ
   - Сохраните
7. **Передеплойте проект** на Vercel

### Шаг 7: Подождите 10-15 минут

После включения API или создания нового ключа может потребоваться время для активации.

## Чеклист проверки:

- [ ] Определен проект, где создан API ключ
- [ ] Выбран правильный проект в Google Cloud Console
- [ ] Custom Search API включен в этом проекте (проверено через "Enabled APIs")
- [ ] API ключ создан в том же проекте
- [ ] API ключ ограничен Custom Search API (или не ограничен, но это может быть проблемой)
- [ ] Переменные окружения обновлены на Vercel
- [ ] Проект передеплоен на Vercel
- [ ] Подождали 10-15 минут после изменений

## Если все проверки пройдены, но ошибка сохраняется:

1. **Попробуйте пересоздать API ключ** (Шаг 6)
2. **Проверьте биллинг:**
   - Google Cloud Console → Billing
   - Убедитесь, что у проекта есть биллинг аккаунт (даже для бесплатного использования)
3. **Используйте альтернативу:** Bing Search API (см. `BING_SEARCH_SETUP.md`)

## Важные моменты:

- **Проект Google Cloud** и **поисковая машина на cse.google.com** - это разные вещи
- Ошибка 403 связана с **проектом Google Cloud**, а не с поисковой машиной
- API ключ и API должны быть в **одном и том же проекте**
- После изменений нужно **подождать несколько минут** для активации

